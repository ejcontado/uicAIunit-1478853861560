!function(a){"function"==typeof define&&define.amd?define(["angular","../const/constants","../banner/position"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("angular"):require("angular")(b)),a(c,require("../const/constants","../banner/position")),c}:a(angular)}(function(a){"use strict";a.module("wf.angular.menuBar",["wf.angular.constants","wf.angular.position"]).constant("wfMenuBarConfig",{appendToOpenClass:"wf-dropdown-open",openClass:"open"}).service("wfMenuBarService",["WF-KEYCODE-CONST","$document","$rootScope",function(a,b,c){var d=null;this.open=function(a){d||b.on("click",e),d&&d!==a&&(d.isOpen=!1),d=a};var e=function(a){if(d&&!(a&&"disabled"===d.getAutoClose()||a&&3===a.keyCode)){var b=d.getToggleElement();if(!(a&&b&&b[0].contains(a.target))){var e=d.getDropdownElement();a&&"outsideClick"===d.getAutoClose()&&e&&e[0].contains(a.target)||(d.isOpen=!1,d.focusToggleElement(),c.$$phase||null!==d&&d.$apply())}}};this.close=function(a){d===a&&(d=null,b.off("click",e))}}]).controller("MenuBarController",["WF-KEYCODE-CONST","$timeout","$scope","$element","$attrs","$parse","wfMenuBarConfig","wfMenuBarService","$animate","$wfPosition","$document","$compile","$templateRequest",function(b,c,d,e,f,g,h,i,j,k,l,m,n){var o,p,q=this,r=d.$new(),s=h.appendToOpenClass,t=h.openClass,u=a.noop,v=f.onToggle?g(f.onToggle):a.noop,w=!1,x=null,y=l.find("body");this.$element=e,e.addClass("dropdown");var z=function(a){a.css("left","auto"),a.removeClass("open");var b=a.parent().find("a").eq(0);b.removeClass("n-dropdown-sub-menu-parent-active")},A=function(b){var c=b.parent()[0].clientWidth,d=b.children(),e={selector:"n-dropdown-sub-menu"},f={tagName:"A"},g=d.eq(F(d,e)),h=d.eq(F(d,f));c<a.element(document.querySelector(".n-banner"))[0].clientWidth-b[0].getBoundingClientRect().left?g.css({left:c+"px"}):g.css({left:"-"+g.clientWidth+"px"});for(var i=b.parent().children(),j=0;j<i.length;j++){var k=i.eq(j);if(k.hasClass("n-dropdown-menu-item-has-child")){var l=k.children();if(l.length)for(var m=0;m<l.length;m++){var n=l.eq(m);n.hasClass("n-dropdown-sub-menu open")&&z(n)}}}g.addClass("open"),h.addClass("n-dropdown-sub-menu-parent-active")},B=function(b){var c=a.element(b.target);if(c.parent().hasClass("n-dropdown-menu-item-has-child")){var d=c.parent().children().eq(1);if(d&&!d.hasClass("open")&&d.hasClass("n-dropdown-sub-menu")){A(c.parent());var e=d.children(),f=e[0].firstElementChild;f.focus()}}},C=function(b){var c=a.element(b.target).parent().parent();if(c.parent().hasClass("n-dropdown-menu-item-has-child")){b.stopPropagation(),z(c),c.parent().hasClass("open")&&c.parent().removeClass("open");var d=c.parent().children();d.length&&(d.eq(0).removeClass("n-dropdown-sub-menu-parent-active"),d[0].focus())}},D=function(b,c){var d,e,f,g=a.element(b.target);if(g.parent().hasClass("dropdown")&&(g.parent().parent().hasClass("dropdown-menu")||g.parent().parent().hasClass("n-dropdown-sub-menu"))){b.stopPropagation(),f=g.parent().parent().children();var h=g[0].innerText.replace(/[\r\n]/g,""),i={innerText:h};if(d=F(f,i),null!==d&&(e=c?d>=1?d-1:0:d<f.length-1?d+1:f.length-1),null!==e){"A"===f[d].firstElementChild.tagName&&f.eq(d).children().eq(0).removeClass("n-dropdown-sub-menu-parent-active");var j=f[e].firstElementChild;j.focus()}}},E=function(a){a.hasClass("n-banner-dropdown-toggle")&&(a.parent().addClass("open"),a.attr("aria-expanded","true"))},F=function(a,b){var c,d,e=a.length;if(b.selector){for(c=0;c<e;c++)if(d=a.eq(c),d.hasClass(b.selector))return c}else if(b.tagName){for(c=0;c<e;c++)if(d=a.eq(c),d[0].nodeName===b.tagName)return c}else if(b.innerText){var f=b.innerText.length;for(c=0;c<a.length;c++){var g=a[c].innerText.substr(0,f);if(g=g.replace(/[\r\n]/g,""),g===b.innerText)return c}}};this.handleKeyDown=function(c){var d=a.element(c.target);switch(c.keyCode){case b.SPACE:case b.ENTER:c.preventDefault(),c.stopPropagation(),E(d),c.preventDefault(),B(c);break;case b.UP:D(c,!0),c.preventDefault();break;case b.DOWN:D(c,!1),c.preventDefault();break;case b.LEFT:C(c);break;case b.RIGHT:B(c);break;default:return}},a.bind(this,this.handleKeyDown),this.mouseOver=function(b){var c=a.element(b.target);c.parent().hasClass("n-dropdown-menu-item-has-child")&&A(c.parent())},this.mouseLeave=function(b){var c=a.element(b.target),d=c.parent();if(d.hasClass("n-dropdown-menu-item-has-child")){var e={selector:"n-dropdown-sub-menu"},f=d.children().eq(F(d.children(),e));z(f)}},this.init=function(){var b=this.$element;if(b.on("keydown",this.handleKeyDown),f.isOpen&&(p=g(f.isOpen),u=p.assign,d.$watch(p,function(a){r.isOpen=!!a})),a.isDefined(f.dropdownAppendTo)){var c=g(f.dropdownAppendTo)(r);c&&(x=a.element(c))}w=a.isDefined(f.dropdownAppendToBody),w&&!x&&(x=y),x&&q.dropdownMenu&&(x.append(q.dropdownMenu),b.on("$destroy",function(){q.dropdownMenu.remove()}))},this.toggle=function(b){return r.isOpen=arguments.length?!!b:!r.isOpen,a.isFunction(u)&&u(r,r.isOpen),r.isOpen},this.isOpen=function(){return r.isOpen},r.getToggleElement=function(){return q.toggleElement},r.getAutoClose=function(){return f.autoClose||"always"},r.getElement=function(){return e},r.getDropdownElement=function(){return q.dropdownMenu},r.focusToggleElement=function(){q.toggleElement&&q.toggleElement[0].focus()},r.$watch("isOpen",function(b,c){if(x&&q.dropdownMenu){var f,g,h,l=k.positionElements(e,q.dropdownMenu,"bottom-left",!0),p=0;if(f={top:l.top+"px",display:b?"block":"none"},g=q.dropdownMenu.hasClass("dropdown-menu-right"),g?(f.left="auto",h=k.scrollbarPadding(x),h.heightOverflow&&h.scrollbarWidth&&(p=h.scrollbarWidth),f.right=window.innerWidth-p-(l.left+e.prop("offsetWidth"))+"px"):(f.left=l.left+"px",f.right="auto"),!w){var y=k.offset(x);f.top=l.top-y.top+"px",g?f.right=window.innerWidth-(l.left-y.left+e.prop("offsetWidth"))+"px":f.left=l.left-y.left+"px"}q.dropdownMenu.css(f)}var z=x?x:e,A=z.hasClass(x?s:t);if(A!==b&&j[b?"addClass":"removeClass"](z,x?s:t).then(function(){a.isDefined(b)&&b!==c&&v(d,{open:!!b})}),b)q.dropdownMenuTemplateUrl&&n(q.dropdownMenuTemplateUrl).then(function(a){o=r.$new(),m(a.trim())(o,function(a){var b=a;q.dropdownMenu.replaceWith(b),q.dropdownMenu=b})}),r.focusToggleElement(),i.open(r,e);else{if(i.close(r,e),q.dropdownMenuTemplateUrl){o&&o.$destroy();var B=a.element('<ul class="dropdown-menu"></ul>');q.dropdownMenu.replaceWith(B),q.dropdownMenu=B}q.selectedOption=null}a.isFunction(u)&&u(d,b)})}]).directive("wfMenuBarDropdown",function(){return{controller:"MenuBarController",link:function(a,b,c,d){d.init()}}}).directive("wfMenuBarDropdownToggle",function(){return{require:"?^wfMenuBarDropdown",link:function(a,b,c,d){if(d){d.toggleElement=b;var e=function(e){e.preventDefault(),e.stopPropagation(),b.hasClass("disabled")||c.disabled||a.$apply(function(){d.toggle()})};b.bind("click",e),b.attr({"aria-haspopup":!0,"aria-expanded":!1}),a.$watch(d.isOpen,function(a){b.attr("aria-expanded",!!a)}),a.$on("$destroy",function(){b.unbind("click",e)})}}}}).directive("wfMenuBar",function(){return{restrict:"E",controller:"MenuBarController",replace:!0,scope:{menuBar:"="},templateUrl:"wf/ng-template/banner/menuBar.html"}}).directive("wfMenuBarInsert",function(){return{restrict:"E",controller:"MenuBarController",replace:!0,scope:{menuBar:"="},templateUrl:"wf/ng-template/banner/menuBar-Insert.html"}}).directive("wfMenuItem",["$compile",function(b){return{restrict:"E",controller:"MenuBarController",replace:!0,scope:{menuItem:"="},templateUrl:"wf/ng-template/banner/menuBarItem.html",link:function(c,d,e,f){if(f&&a.isArray(c.menuItem.children)){d.append('<wf-menu-bar-insert  menu-bar="menuItem.children" ></wf-menu-bar-insert>'),d.on("mouseleave",function(a){f.mouseLeave(a)}),d.on("mouseover",function(a){f.mouseOver(a)});for(var g=d.parent(),h=!1;g.length>0&&!h;)g.hasClass("navbar-right")&&(h=!0),g=g.parent();h&&d.addClass("dropdown-submenu-right"),b(d.contents())(c)}}}}]),a.module("wf.angular.menuBar").run(["$templateCache",function(a){a.put("wf/ng-template/banner/menuBar.html","<ul class='dropdown-menu'>\n    <wf-menu-item ng-cloak ng-repeat='menuItem in menuBar' menu-item='menuItem'></wf-menu-item>\n</ul>")}]),a.module("wf.angular.menuBar").run(["$templateCache",function(a){a.put("wf/ng-template/banner/menuBarItem.html","<li  ng-cloak ng-class=\"{'n-dropdown-menu-item-has-child': menuItem.hasChild}\">\n    <a href={{menuItem.link}}>\n        <span>{{menuItem.label}}</span>\n        <i  ng-class=\"{'icon icon-next': menuItem.hasChild}\"></i>\n    </a>\n</li>")}]),a.module("wf.angular.menuBar").run(["$templateCache",function(a){a.put("wf/ng-template/banner/menuBar-Insert.html","<ul class='n-dropdown-sub-menu'>\n    <wf-menu-item ng-cloak ng-repeat='menuItem in menuBar' menu-item='menuItem'></wf-menu-item>\n</ul>")}])});