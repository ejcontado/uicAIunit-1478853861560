!function(a){"function"==typeof define&&define.amd?define(["angular","../const/constants"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("angular"):require("angular")(b)),a(c,require("../const/constants")),c}:a(angular)}(function(a){"use strict";var b=function(b,c,d){function e(a){for(var b=0;b<g.panes.length;b++)if(b===a)return b}var f,g=this,h=this.panes=[];b.$watch("$ctrl.active",function(a,b){a&&a!==f&&g.select(e(a))}),this.select=function(a,b){var c=g.panes[a];if(c&&!c.disable){var d=e(f),h=g.panes[d];if(h){if(h.onDeselect({$event:b,$selectedIndex:a}),b&&b.isDefaultPrevented())return;h.selected=!1}c.onSelect({$event:b}),c.selected=!0,g.active=a,f=a}};var i=function(a,b){var c=g.panes[a];return c&&(c.selected=!1),!0},j=function(a,b){var c=h[a];c.onSelect({$event:b}),c.selected=!0},k=function(){for(var a=h.length,b=null,c=0;c<a;c++)if(!h[c].disable){b=c;break}return b},l=function(a){for(var b=null,c=h.length,d=0;d<c;d++)h[d]===a&&(b=d);return b};this.addPane=function(a){h.push(a);var b=h.length-1;g.active===b&&(a.selected=!0)},this.selectPane=function(a,b){var c=l(a);if(null!==c){if(a.disable)return;if(null!==g.active&&!i(c,b))return;i(g.active),j(c,b),g.active=c}},this.removePane=function(a){var b=l(a);if(null!==b){if(h.splice(b,1),b===f){g.active=null;var c=k();g.select(c)}else b<f&&g.select(e(g.active-1))}},this.closePane=function(a,b){a=e(a);var c=g.panes[a];null!==a&&c&&(c.disable||c.onClose({$event:b,$closedIndex:a}))};var m=function(a){for(var b=l(a),c=h.length,d=null,e=++b;e<c;e++)if(!h[e].disable){d=e;break}return d},n=function(a){for(var b=l(a),c=null,d=--b;d>=0;d--)if(!h[d].disable){c=d;break}return c},o=function(b,c){var d=a.element(b.target).parent().parent();return d.find("li")[c].firstElementChild},p=function(a,b){var c=o(a,b);d(function(){c.focus()},0)};this.closeKeydown=function(a,b){var d=b.which;d===c.SPACE&&(this.closePane(a,b),b.preventDefault())},this.selectKeydown=function(b,d){var e;switch(d.which){case c.TAB:e=m(b),null===e&&a.element(d.target).parent().next().find("a").attr("tabIndex",-1);break;case c.SPACE:this.select(l(b),d),d.preventDefault();break;case c.RIGHT:case c.DOWN:e=m(b),null!==e&&p(d,e),d.preventDefault();break;case c.LEFT:case c.UP:var f=n(b);null!==f&&p(d,f),d.preventDefault()}},this.$onInit=function(){this.active=a.isDefined(this.active)&&!isNaN(this.active)?this.active:0,f=this.active},this.$onDestroy=function(){this.destroyed=!0},this.selectNextPane=function(a){var b=m(a);null===b&&(b=k()),g.select(b)}};b.$inject=["$scope","WF-KEYCODE-CONST","$timeout"];var c=function(a,b){var c=this;this.selected=!1,this.closeable=!!b.close,this.$onInit=function(){this.tabsCtrl.addPane(this)},a.$watch("$ctrl.disable",function(a,b){if(a!==b&&a&&c.selected){var d=c.tabsCtrl;d.selectNextPane(c)}}),this.$onDestroy=function(){this.tabsCtrl&&!this.tabsCtrl.destroyed&&this.tabsCtrl.removePane(this)}};c.$inject=["$scope","$attrs"],a.module("wf.angular.tabs",["wf.angular.constants"]).component("wfTabs",{transclude:!0,templateUrl:"wf/ng-template/tabs/tabs.html",bindings:{active:"=?"},controller:b}).component("wfPane",{transclude:!0,templateUrl:"wf/ng-template/tabs/tabsItem.html",require:{tabsCtrl:"^wfTabs"},bindings:{label:"@",disable:"<?",onSelect:"&select",onDeselect:"&deselect",onClose:"&close"},controller:c})});