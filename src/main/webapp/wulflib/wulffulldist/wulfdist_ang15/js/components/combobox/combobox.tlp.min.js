!function(a){"function"==typeof define&&define.amd?define(["angular","../const/constants"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("angular"):require("angular")(b)),a(c,require("../const/constants")),c}:a(angular)}(function(a){"use strict";var b=function(b,c,d,e){var f=this;this.isOpen=!1,this.comboboxClass=[],this.dropdownWidth=0,this.selectedItemText="",this.selectedItemValue="",this.menuWidth="",this.menuDisplay="";var g=function(){setTimeout(function(){f.isOpen&&f.close()},0)},h=function(a,b){return(" "+a.className+" ").replace(/[\n\t]/g," ").indexOf(" "+b+" ")>-1},i=function(a){var b=a.prop("tagName");"BUTTON"===b?f.isTextfield(f.pattern)?f.dropdownWidth=a.parent().parent()[0].clientWidth:f.isMenu(f.pattern)&&(f.dropdownWidth=a.parent().find("button")[0].clientWidth+a[0].clientWidth+2):"SPAN"===b&&(f.isTextfield(f.pattern)?f.dropdownWidth=a.parent().parent().parent()[0].clientWidth:f.isMenu(f.pattern)&&void 0!==a.parent().attr("class")&&(f.dropdownWidth=a.parent().parent().find("button")[0].clientWidth+a.parent()[0].clientWidth+2))};this.isTextfield=function(a){return"textfield"===a||"clearable-textfield"===a},this.isMenu=function(a){return"menu"===a||"sm-menu"===a||"file-selection"===a},void 0===this.pattern&&(this.pattern="textfield"),void 0===this.disable&&(this.disable=!1),this.isTextfield(this.pattern)?(this.comboboxClass.push("input-group"),this.comboboxClass.push("combobox")):this.isMenu(this.pattern)&&(this.menuWidth="100%",this.menuDisplay="block",this.comboboxClass.push("btn-group"),this.comboboxClass.push("n-combobutton"),"sm-menu"!==this.pattern&&"small"!==this.sizeStyle||this.comboboxClass.push("n-combobutton-small")),this.open=function(){this.isOpen=!0,d(function(){b.on("click",g)},0)},this.close=function(){this.isOpen=!1,d(function(){b.off("click",g)},0)},this.toggle=function(b){var c=a.element(b.target),d=c.prop("tagName");"INPUT"===d?this.close():"BUTTON"!==d&&"SPAN"!==d&&"A"!==d||(this.isOpen?this.close():(i(c),this.open()))},this.keyboardStepInList=function(b){var c=b.keyCode,d=a.element(b.target);if(c===e.DOWN){if(h(b.target,"dropdown-toggle")){b.preventDefault();for(var f=d.parent().find("ul").find("li"),g=0;g<f.length;g++)if(!f.eq(g).find("a")[0].disabled){f.eq(g).find("a")[0].focus();break}}}else c===e.ESC&&this.close()},this.clearContent=function(b){var c=b.keyCode,d=a.element(b.target);c===e.SPACE?(b.preventDefault(),this.selectedItemText="",d.parent().find("input")[0].focus()):void 0===c&&(this.selectedItemText="",d.parent().parent().find("input")[0].focus())}};b.$inject=["$document","$element","$timeout","WF-KEYCODE-CONST"];var c=function(b,c,d){var e=this;void 0===this.disable&&(this.disable=!1),void 0===this.selected&&(this.disable=!1),void 0===this.itemText&&(this.itemText=this.itemValue),this.init=function(){this.selected&&(this.parent.selectedItemValue=this.itemValue,void 0===this.itemText?this.parent.selectedItemText=this.itemValue:this.parent.selectedItemText=this.itemText),"file-selection"===this.parent.pattern&&(this.fileSelection=function(a){d[0].querySelector(".n-file-input").click()},this.clearFile=function(){a.element(d.parent().parent().parent()[0].querySelector(".n-combobutton-btn>span>span")).html("")},a.element(document).ready(function(){var b=a.element(d[0].querySelector(".n-file-input"));b.on("change",function(){var b=this.value.split("\\")[this.value.split("\\").length-1];a.element(d.parent().parent().parent()[0].querySelector(".n-combobutton-btn>span>span")).html(b),e.getFile()&&"function"==typeof e.getFile&&e.getFile()(b,this.value)})}))},c(function(){e.init()},0),this.selectItem=function(b){this.parent.toggle(b);var c=a.element(b.target);this.selected=!0,this.parent.selectedItemValue=this.itemValue,this.parent.selectedItemText=this.itemText,"file-selection"===this.parent.pattern&&("n-file-select"===c.attr("class")?this.fileSelection():this.clearFile());var d=null;this.parent.isTextfield(this.pattern)?(d=c.parent().parent().parent().parent().find("button")[0],void 0===d&&(d=c.parent().parent().parent().parent().parent().parent().find("button")[0]),d.focus()):this.parent.isMenu(this.pattern)&&(d=c.parent().parent().parent().parent().parent().find("button")[1],void 0===d&&(d=c.parent().parent().parent().parent().parent().parent().parent().find("button")[1]),d.focus()),this.onItemSelected()&&"function"==typeof this.onItemSelected&&this.onItemSelected()(this.itemValue,this.itemText,b)};var f=function(a,b){for(var c=null,d=0;d<b.length;d++)b[d]===a[0]&&(c=d);return c},g=function(a,b,c){var d=f(a,b),e=null,g=0;if(c){for(g=++d;g<b.length;g++)if(!b[g].firstElementChild.disabled){e=g;break}}else for(g=--d;g>=0;g--)if(!b[g].firstElementChild.disabled){e=g;break}return e},h=function(a,b){return a[b].firstElementChild},i=function(a,b){var d=h(a,b);c(function(){d.focus()},0)},j=function(a,b,c){a.preventDefault();var d=b.parent().parent().find("li"),e=g(b,d,c);null!==e&&i(d,e)};this.keyboardNavigation=function(c){var d=c.keyCode,e=a.element(c.target),f=e.parent(),g=!1;switch(d){case b.UP:g=!1,j(c,f,g);break;case b.DOWN:g=!0,j(c,f,g);break;case b.SPACE:c.preventDefault(),this.selectItem(c);break;case b.ESC:c.preventDefault(),this.parent.close()}}};c.$inject=["WF-KEYCODE-CONST","$timeout","$element"],a.module("wf.angular.combobox",["wf.angular.constants"]).component("wfCombobox",{transclude:!0,templateUrl:"wf/ng-template/combobox/combobox.html",bindings:{pattern:"<",disable:"<?",sizeStyle:"<?"},controller:b}).component("wfComboboxItem",{transclude:!0,templateUrl:"wf/ng-template/combobox/comboboxItem.html",require:{parent:"^^wfCombobox"},bindings:{pattern:"<",itemValue:"<",itemText:"<",disable:"<?",selected:"<?",onItemSelected:"&",getFile:"&"},controller:c}),a.module("wf.angular.combobox").run(["$templateCache",function(a){a.put("wf/ng-template/combobox/combobox.html","<div ng-class=\"[$ctrl.comboboxClass, {'combobox-open':$ctrl.isOpen, 'open':$ctrl.isOpen, 'n-cancel-button': $ctrl.pattern === 'clearable-textfield'}]\">\n    <input ng-show=\"$ctrl.pattern === 'textfield' || $ctrl.pattern === 'clearable-textfield'\" ng-click=\"$ctrl.toggle($event)\" type=\"text\"\n"+'           class="form-control n-inputfield" ng-model="$ctrl.selectedItemText" ng-disabled="$ctrl.disable">\n    <a ng-show="$ctrl.pattern === \'clearable-textfield\' && $ctrl.selectedItemText.length > 0" ng-click="$ctrl.clearContent($event)"\n       ng-keydown="$ctrl.clearContent($event)" class="n-clear-button-icon" href="javascript:void(0)" ng-disabled="$ctrl.disable">\n        <span role="button" aria-label="clear content" class="icon icon-close"></span>\n    </a>\n    <button ng-show="$ctrl.pattern === \'menu\' || $ctrl.pattern === \'sm-menu\' || $ctrl.pattern === \'file-selection\'" ng-disabled="$ctrl.disable"\n            ng-class="[{\'combobox-menu-open\':$ctrl.isOpen,\'combobox-menu-close\':!$ctrl.isOpen}]" ng-style="{\'padding-right\': \'8px\'}"\n            type="button" class="btn n-combobutton-btn" aria-expanded="false">\n        <span class="selected-label" ng-style="{\'max-width\':\'100%\'}">\n            <span ng-bind="$ctrl.selectedItemText" ng-style="{\'overflow\':\'hidden\', \'text-overflow\':\'ellipsis\', \'max-width\':\'100%\'}"></span>\n        </span>\n    </button>\n    <button ng-show="$ctrl.pattern === \'menu\' || $ctrl.pattern === \'sm-menu\' || $ctrl.pattern === \'file-selection\'" ng-click="$ctrl.toggle($event)"\n            ng-disabled="$ctrl.disable" type="button" class="btn dropdown-toggle" aria-expanded="{{$ctrl.isOpen}}"\n            ng-keydown="$ctrl.keyboardStepInList($event)">\n        <span class="caret"></span>\n        <span class="sr-only">Toggle Dropdown</span>\n    </button>\n    <div class="input-group-btn" ng-style="{\'width\':$ctrl.menuWidth,\'display\':$ctrl.menuDisplay}">\n        <button ng-show="$ctrl.pattern === \'textfield\' || $ctrl.pattern === \'clearable-textfield\'" ng-click="$ctrl.toggle($event)" ng-disabled="$ctrl.disable"\n                type="button" class="btn btn-default dropdown-toggle" aria-expanded="{{$ctrl.isOpen}}"\n                ng-keydown="$ctrl.keyboardStepInList($event)">\n            <span class="caret"></span>\n        </button>\n        <ul ng-class="[\'dropdown-menu\', {\'dropdown-menu-right\':$ctrl.pattern === \'textfield\' || $ctrl.pattern === \'clearable-textfield\'}]" style="display: block"\n            ng-style="{\'width\':$ctrl.pattern === \'menu\' || $ctrl.pattern === \'sm-menu\' || $ctrl.pattern === \'file-selection\' ? \'100%\' : $ctrl.dropdownWidth+\'px\'}" ng-show="$ctrl.isOpen === true" ng-transclude>\n        </ul>\n    </div>\n</div>\n')}]),a.module("wf.angular.combobox").run(["$templateCache",function(a){a.put("wf/ng-template/combobox/comboboxItem.html",'<li ng-if="$ctrl.parent.pattern !== \'file-selection\'" ng-cloak data-value="{{$ctrl.itemValue}}" data-selected="{{$ctrl.parent.selectedItemValue === $ctrl.itemValue}}" ng-class="{\'selected\': $ctrl.parent.selectedItemValue === $ctrl.itemValue}">\n    <a href ng-click="$ctrl.selectItem($event)" ng-keydown="$ctrl.keyboardNavigation($event)"  ng-disabled="$ctrl.disable" tabindex="{{$ctrl.disable ? -1 : null}}">\n        <span class="ng-item">{{$ctrl.itemText === undefined ? $ctrl.itemValue : $ctrl.itemText}}</span>\n    </a>\n</li>\n\n\n<li ng-if="$ctrl.parent.pattern === \'file-selection\'"  ng-cloak>\n    <a href="javascript:void(0);" ng-click="$ctrl.clearFile()" ng-keydown="$ctrl.keyboardNavigation($event)">\n        <span class="ng-item"></span>\n    </a>\n</li>\n<li ng-if="$ctrl.parent.pattern === \'file-selection\'" ng-cloak>\n    <a ng-click="$ctrl.fileSelection($event)" class="n-file-select"  href="javascript:void(0);"  ng-keydown="$ctrl.keyboardNavigation($event)"  ng-disabled="$ctrl.disable" tabindex="{{$ctrl.disable ? -1 : null}}">\n        <span class="icon icon-folder-open" style="border-bottom:none"></span>\n        <span class="ng-item">{{$ctrl.itemValue === undefined ? "Browse...":$ctrl.itemValue}}</span>\n    </a>\n    <div  class="n-file-upload">\n        <input type="file" class="n-file-input" tabindex="-1"/>\n    </div>\n</li>')}])});